{{ define "main" }}
<h1 class="text-4xl font-bold mb-8 text-primary-dark">{{ .Title }}</h1>

{{ $pages := .Pages }}
{{ $pagesWithYear := where $pages "Params.year" "!=" nil }}
{{ $pagesWithoutYear := where $pages "Params.year" "=" nil }}

<!-- Pages with year - grouped display -->
{{ if $pagesWithYear }}
    {{ $grouped := $pagesWithYear.GroupByParam "year" }}
    <div class="space-y-8">
        {{ range $grouped.Reverse }}
        <div class="weight-group mb-6">
            <h2 class="text-2xl font-bold mb-4 bg-gray-200 p-2 rounded">{{ .Key }}</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {{ range sort .Pages "Title" "asc" }}
                    <!-- Create custom content for nested albums -->
                    {{ $cardContent := .Description }}
                    {{ if eq .Params.layout "list" }}
                        {{ $nestedContent := .Description }}
                        {{ $nestedContent = printf "%s<div class='mt-3 border-t border-gray-200 pt-3'><p class='text-sm font-semibold mb-2'>Sub-albums:</p><ul class='space-y-1 pl-4'>" $nestedContent }}
                        
                        {{ range .Pages }}
                            {{ $nestedContent = printf "%s<li><a href='%s' class='text-accent hover:underline'>>> %s</a></li>" $nestedContent (.RelPermalink | relLangURL) .Title }}
                        {{ end }}
                        
                        {{ $nestedContent = printf "%s</ul></div>" $nestedContent }}
                        {{ $cardContent = $nestedContent }}
                    {{ end }}
                
                    <!-- Use card partial -->
                    {{ partial "card.html" (dict
                        "title" .Title
                        "content" $cardContent
                        "goToLink" (.RelPermalink | relLangURL)
                        "goToText" (T "learnMoreText")
                        "withShadow" true
                        "fullHeight" true) }}
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>
{{ end }}

<!-- Pages without year (simple list) -->
{{ if $pagesWithoutYear }}
    <div class="space-y-6 mb-6">
        <h2 class="text-xl font-bold mb-4">Other Albums</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {{ range sort $pagesWithoutYear "Title" "asc" }}
                <!-- Create custom content for nested albums -->
                {{ $cardContent := .Description }}
                {{ if eq .Params.layout "list" }}
                    {{ $nestedContent := .Description }}
                    {{ $nestedContent = printf "%s<div class='mt-3 border-t border-gray-200 pt-3'><p class='text-sm font-semibold mb-2'>Sub-albums:</p><ul class='space-y-1 pl-4'>" $nestedContent }}
                    
                    {{ range .Pages }}
                        {{ $nestedContent = printf "%s<li><a href='%s' class='text-accent hover:underline'>>> %s</a></li>" $nestedContent (.RelPermalink | relLangURL) .Title }}
                    {{ end }}
                    
                    {{ $nestedContent = printf "%s</ul></div>" $nestedContent }}
                    {{ $cardContent = $nestedContent }}
                {{ end }}
            
                <!-- Use card partial -->
                {{ partial "card.html" (dict
                    "title" .Title
                    "content" $cardContent
                    "goToLink" (.RelPermalink | relLangURL)
                    "goToText" (T "learnMoreText")
                    "withShadow" true
                    "fullHeight" true) }}
            {{ end }}
        </div>
    </div>
{{ end }}

<!-- Message if no pages -->
{{ if not $pages }}
    {{ partial "card.html" (dict
        "content" "Non ci sono ancora album in questa sezione."
        "withShadow" true) }}
{{ end }}
{{ end }}